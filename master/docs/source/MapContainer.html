<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js">/* Copyright (c) 2015-present terrestris GmbH &amp; Co. KG
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.
 */
<span id='BasiGX-view-panel-MapContainer'>/**
</span> * MapContainer Panel
 *
 * Represents a main viewport which holds the map and other map related
 * components. Using this container leads to a map with integrated or
 * overlapping components, instead of arranging them in a border layout.
 *
 * @class BasiGX.view.panel.MapContainer
 */
Ext.define(&#39;BasiGX.view.panel.MapContainer&#39;, {
    extend: &#39;Ext.panel.Panel&#39;,
    xtype: &#39;basigx-panel-mapcontainer&#39;,

    requires: [
        &#39;Ext.dom.Query&#39;,
        &#39;Ext.app.ViewModel&#39;,
        &#39;GeoExt.data.store.LayersTree&#39;,
        &#39;GeoExt.component.OverviewMap&#39;,

        &#39;BasiGX.util.Layer&#39;,
        &#39;BasiGX.view.component.Map&#39;,
        &#39;BasiGX.view.panel.LegendTree&#39;,
        &#39;BasiGX.view.panel.Menu&#39;,

        &#39;BasiGX.view.button.ZoomIn&#39;,
        &#39;BasiGX.view.button.ZoomOut&#39;,
        &#39;BasiGX.view.button.ZoomToExtent&#39;,
        &#39;BasiGX.view.button.ToggleLegend&#39;
    ],

<span id='BasiGX-view-panel-MapContainer-property-viewModel'>    /**
</span>     *
     */
    viewModel: {
        data: {
            titleLegendPanel: &#39;Legende&#39;,
            documentation: &#39;&lt;h2&gt;Karte&lt;/h2&gt;• Die Karte wird zur Darstellung &#39; +
                &#39;der verschiedenen Kartenthemen verwendet.&lt;br&gt;• Mit Hilfe &#39; +
                &#39;des Themenbaums oder der Werkzeuge können Sie mit der &#39; +
                &#39;Karte interagieren.&lt;br&gt;• Standardmäßig können Sie den &#39; +
                &#39;Maßstab der Karte mit dem Mausrad oder einem Doppelklick &#39; +
                &#39;vergrößern und verkleinern.&lt;br&gt;• Für weitere Informationen &#39; +
                &#39;verwenden Sie die Hilfe für ein konkretes Werkzeug&#39;
        }
    },

<span id='BasiGX-view-panel-MapContainer-property-layout'>    /**
</span>     *
     */
    layout: &#39;absolute&#39;,

<span id='BasiGX-view-panel-MapContainer-property-header'>    /**
</span>     *
     */
    header: false,

<span id='BasiGX-view-panel-MapContainer-property-mapPanel'>    /**
</span>     * The mapPanel containing the map.
     */
    mapPanel: null,

<span id='BasiGX-view-panel-MapContainer-property-config'>    /**
</span>     * Config
     */
    config: {
<span id='BasiGX-view-panel-MapContainer-cfg-mapComponentConfig'>        mapComponentConfig: {
</span>            xtype: &#39;basigx-component-map&#39;,
            anchor: &#39;100% 100%&#39;
        },
<span id='BasiGX-view-panel-MapContainer-cfg-menuConfig'>        menuConfig: {
</span>            xtype: &#39;basigx-panel-menu&#39;,
            width: 300,
            items: []
        },
<span id='BasiGX-view-panel-MapContainer-cfg-toolbarConfig'>        toolbarConfig: {
</span>            xtype: &#39;toolbar&#39;,
            vertical: true,
            width: 50,
            cls: &#39;basigx-map-tools&#39;,
            x: 0,
            y: 0,
            defaults: {
                scale: &#39;large&#39;
            }
        },
<span id='BasiGX-view-panel-MapContainer-cfg-overviewMapConfig'>        overviewMapConfig: {
</span>            xtype: &#39;gx_overviewmap&#39;,
            magnification: 10,
            width: 400,
            height: 150,
            padding: 5,
            cls: &#39;basigx-overview-map&#39;,
            hidden: true,
            layers: [
                new ol.layer.Tile({
                    source: new ol.source.TileWMS({
                        url: &#39;http://ows.terrestris.de/osm/service?&#39;,
                        params: {&#39;layers&#39;: &#39;OSM-WMS&#39;, &#39;TILED&#39;: true}
                    })
                })
            ]
        },
<span id='BasiGX-view-panel-MapContainer-cfg-overviewMapToggleButtonConfig'>        overviewMapToggleButtonConfig: {
</span>            xtype: &#39;button&#39;,
            scale: &#39;large&#39;,
            helpKey: &#39;basigx-overview-map-button&#39;,
            cls: &#39;basigx-overview-map-button&#39;,
            glyph: &#39;xf0ac@FontAwesome&#39;,
            enableToggle: true
        },
<span id='BasiGX-view-panel-MapContainer-cfg-legendPanelConfig'>        legendPanelConfig: {
</span>            xtype: &#39;basigx-panel-legendtree&#39;,
            width: 250,
            height: 300,
            layout: &#39;fit&#39;,
            collapsible: true,
            collapsed: true,
            hideCollapseTool: true,
            collapseDirection: &#39;bottom&#39;,
            titleCollapse: true,
            titleAlign: &#39;center&#39;,
            rootVisible: false,
            bind: {
                title: &#39;{titleLegendPanel}&#39;
            }
        },
<span id='BasiGX-view-panel-MapContainer-cfg-additionalItems'>        /* use this property for additional items that can not be added
</span>         * to &quot;items&quot; immediately as they depend on the map or
         * other components that are built in the MapContainer and should be
         * instanciated first
         */
        additionalItems: []
    },

<span id='BasiGX-view-panel-MapContainer-event-overviewmapToggle'>    /**
</span>     * Fired when the overviewmap is toggled.
     * @event overviewmapToggle
     */

<span id='BasiGX-view-panel-MapContainer-method-initComponent'>    /**
</span>     * Init
     */
    initComponent: function() {
        var me = this;

        // call parent (we can use this.add() after this call)
        me.callParent();

        /* add the map component and set it as member
         * the map should be built first as some other components
         * depend on it
         */
        me.addMapComponent();

        // add the menu. TODO: make optional based on config and pass menuItems
        me.addMenu();

        // add the toolbar. TODO: make optional based on config
        me.addToolbar();

        // add the overview map. TODO make optional based on config
        me.addOverviewMap();

        // add the overview map toggle button. TODO make optional
        me.addOverviewMapToggleButton();

        /* add additional items (that possibly depend on the map or other
         * components that were built in the lines before)
         */
        me.addAdditionalItems();

        // TODO make optional based on config
        me.on(&#39;afterrender&#39;, me.addLegendPanel, me, {single: true});
    },

<span id='BasiGX-view-panel-MapContainer-method-addMapComponent'>    /**
</span>     *
     */
    addMapComponent: function() {
        var me = this;

        var mapComponent = me.getMapComponentConfig();

        me.add(mapComponent);

        // query the mapPanel we just built to set it as a member
        me.mapPanel = me.down(mapComponent.xtype);
    },

<span id='BasiGX-view-panel-MapContainer-method-addMenu'>    /**
</span>     *
     */
    addMenu: function() {
        var me = this;

        var menu = me.getMenuConfig();

        me.add(menu);
    },

<span id='BasiGX-view-panel-MapContainer-method-addToolbar'>    /**
</span>     *
     */
    addToolbar: function() {
        var me = this;

        var toolbar = me.getToolbarConfig();

        if (!toolbar.items) {
            toolbar.items = me.buildToolbarItems();
        }

        me.add(toolbar);
    },

<span id='BasiGX-view-panel-MapContainer-method-addOverviewMap'>    /**
</span>     *
     */
    addOverviewMap: function() {
        var me = this;

        var overviewMap = me.getOverviewMapConfig();

        // set the overviewmap parent map
        if (!overviewMap.parentMap &amp;&amp; me.mapPanel) {
            overviewMap.parentMap = me.mapPanel.getMap();
        }

        me.add(overviewMap);
    },

<span id='BasiGX-view-panel-MapContainer-method-addOverviewMapToggleButton'>    /**
</span>     *
     */
    addOverviewMapToggleButton: function() {
        var me = this;

        var overviewMapToggleButton = me.getOverviewMapToggleButtonConfig();

        // set the toggleHandler if not configured
        if (!overviewMapToggleButton.toggleHander &amp;&amp; me.toggleOverviewMap) {
            overviewMapToggleButton.toggleHandler = me.toggleOverviewMap;
        }

        // set the scope (e.g. for handler or toggleHandler)
        if (!overviewMapToggleButton.scope) {
            overviewMapToggleButton.scope = me;
        }

        me.add(overviewMapToggleButton);
    },

<span id='BasiGX-view-panel-MapContainer-method-addAdditionalItems'>    /**
</span>     *
     */
    addAdditionalItems: function() {
        var me = this;

        var additionalItems = me.getAdditionalItems();

        me.add(additionalItems);
    },

<span id='BasiGX-view-panel-MapContainer-method-addLegendPanel'>    /**
</span>     *
     */
    addLegendPanel: function() {
        var me = this;

        var legendTreeConfig = me.getLegendPanelConfig();


        // set the store if not configured
        if (!legendTreeConfig.store &amp;&amp; me.mapPanel) {
            var treeStore = Ext.create(&#39;GeoExt.data.store.LayersTree&#39;, {
                layerGroup: me.mapPanel.getMap().getLayerGroup()
            });
            treeStore.addFilter(function(rec) {
                var layer = rec.getOlLayer();
                var util = BasiGX.util.Layer;
                var showKey = util.KEY_DISPLAY_IN_LAYERSWITCHER;
                if (layer &amp;&amp; layer.get(showKey) === false) {
                    return false;
                }
                return true;
            });

            // set the store
            legendTreeConfig.store = treeStore;
        }

        // add the legend panel
        me.add(legendTreeConfig);
    },

<span id='BasiGX-view-panel-MapContainer-method-buildToolbarItems'>    /**
</span>     * Returns an array of ExtJS configurations for toolbar items.
     *
     * @return {Array&lt;Object&gt;} An array of ExtJS configurations for toolbar
     *     items (mostly buttons).
     */
    buildToolbarItems: function() {
        var toolbarItems = [{
            xtype: &#39;basigx-button-zoomin&#39;
        }, {
            xtype: &#39;basigx-button-zoomout&#39;
        }, {
            xtype: &#39;basigx-button-zoomtoextent&#39;
        }, {
            xtype: &#39;basigx-button-togglelegend&#39;
        }];

        return toolbarItems;
    },

<span id='BasiGX-view-panel-MapContainer-method-toggleOverviewMap'>    /**
</span>     * Toggles the overviewmap.
     *
     * @param {Ext.button.Button} button The toggle button for the overview map.
     * @param {Boolean} pressed Whether the butten is currently pressed or not.
     */
    toggleOverviewMap: function(button, pressed) {
        var ovm = button.up(&#39;basigx-panel-mapcontainer&#39;)
            .down(&#39;gx_overviewmap&#39;);
        if (pressed) {
            ovm.show(button);
        } else {
            ovm.hide(button);
        }
        button.blur();
        this.toggleScalelineAdjustment();
        this.toggleScalecomboAdjustment();
        this.fireEvent(&#39;overviewmapToggle&#39;, ovm);
    },

<span id='BasiGX-view-panel-MapContainer-method-toggleScalelineAdjustment'>    /**
</span>     * Called from #toggleOverviewMap, this method toggles a CSS class on
     * the Openlayers scaleline HTML element.
     */
    toggleScalelineAdjustment: function() {
        var scaleline = Ext.dom.Query.select(&#39;.ol-scale-line&#39;)[0];
        var scalelineElem;
        if (scaleline) {
            scalelineElem = Ext.get(scaleline);
        }
        if (scalelineElem) {
            scalelineElem.toggleCls(&#39;basigx-scaline-adjusted&#39;);
        }
    },

<span id='BasiGX-view-panel-MapContainer-method-toggleScalecomboAdjustment'>    /**
</span>     * Called from #toggleOverviewMap, this method toggles a CSS class on
     * the BasiGX scale combo HTML element.
     */
    toggleScalecomboAdjustment: function() {
        var scaleCombo = Ext.ComponentQuery.query(&#39;basigx-combo-scale&#39;)[0];
        var scaleComboEl;
        if (scaleCombo) {
            scaleComboEl = scaleCombo.getEl();
        }
        if (scaleComboEl) {
            scaleComboEl.toggleCls(&#39;basigx-combo-scale-adjusted&#39;);
        }
    }
});
</pre>
</body>
</html>
