<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js">/* Copyright (c) 2019-present terrestris GmbH &amp; Co. KG
 *
 * This program is free software: you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation, either version 3 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program.  If not, see &lt;http://www.gnu.org/licenses/&gt;.
 */
<span id='BasiGX-util-SldOpenlayersConverter'>/**
</span> * Utility class containing static methods for working with SLD.
 *
 * @class BasiGX.util.SldOpenlayersConverter
 */
Ext.define(&#39;BasiGX.util.SldOpenlayersConverter&#39;, {
    requires: [
        &#39;BasiGX.util.Jsonix&#39;
    ],
    statics: {
<span id='BasiGX-util-SldOpenlayersConverter-static-property-DEFAULT_STROKE_OPACITY'>        DEFAULT_STROKE_OPACITY: 1,
</span><span id='BasiGX-util-SldOpenlayersConverter-static-property-DEFAULT_STROKE_COLOR'>        DEFAULT_STROKE_COLOR: &#39;#000000&#39;,
</span><span id='BasiGX-util-SldOpenlayersConverter-static-property-DEFAULT_STROKE_WIDTH'>        DEFAULT_STROKE_WIDTH: 0,
</span><span id='BasiGX-util-SldOpenlayersConverter-static-property-DEFAULT_FILL_OPACITY'>        DEFAULT_FILL_OPACITY: 1,
</span>
<span id='BasiGX-util-SldOpenlayersConverter-static-method-setStaticJsonixReferences'>        /**
</span>         *
         */
        setStaticJsonixReferences: function() {
            // empty stub to obtain backwards compatibility
        },

<span id='BasiGX-util-SldOpenlayersConverter-static-method-getSldNameFromSld'>        /**
</span>         * @param {Object} sldObj The SLD object.
         * @return {String} The name of the SLD.
         */
        getSldNameFromSld: function(sldObj) {
            return sldObj.value.namedLayerOrUserLayer[0]
                .namedStyleOrUserStyle[0].name;
        },

<span id='BasiGX-util-SldOpenlayersConverter-static-method-toSldObject'>        /**
</span>         * @param {String} sldStr The SLD string.
         * @return {Object} The SLD object.
         */
        toSldObject: function(sldStr) {
            try {
                var util = BasiGX.util.Jsonix;
                return util.unmarshaller.unmarshalString(
                    sldStr
                );
            } catch (e) {
                return null;
            }
        },

<span id='BasiGX-util-SldOpenlayersConverter-static-method-toSldString'>        /**
</span>         * @param {Object} sldObject The SLD object.
         * @return {String} The SLD string.
         */
        toSldString: function(sldObject) {
            if (sldObject.value.namedLayerOrUserLayer[0]
                .namedStyleOrUserStyle[0].isDefault) {
                delete sldObject.value.namedLayerOrUserLayer[0]
                    .namedStyleOrUserStyle[0].isDefault;
            }
            var util = BasiGX.util.Jsonix;
            return util.marshaller.marshalString(sldObject);
        },

<span id='BasiGX-util-SldOpenlayersConverter-static-method-guessGeometryTypeFromSldString'>        /**
</span>         * @param {String} sldString The SLD string.
         * @return {String} The type of the geometry.
         */
        guessGeometryTypeFromSldString: function(sldString) {
            if (sldString.indexOf(&#39;PointSymbolizer&#39;) &gt; 0) {
                return &#39;Point&#39;;
            }
            if (sldString.indexOf(&#39;PolygonSymbolizer&#39;) &gt; 0) {
                return &#39;Polygon&#39;;
            }
            if (sldString.indexOf(&#39;LineSymbolizer&#39;) &gt; 0) {
                return &#39;Line&#39;;
            }
        },

<span id='BasiGX-util-SldOpenlayersConverter-static-method-rulesFromSldObject'>        /**
</span>         * @param {Object} sldObject The SLD object.
         * @return {Array} The Array of rules.
         */
        rulesFromSldObject: function(sldObject) {

            var firstNamedLayerOrUserLayer;

            if (sldObject &amp;&amp; sldObject.value &amp;&amp;
                sldObject.value.namedLayerOrUserLayer &amp;&amp;
                sldObject.value.namedLayerOrUserLayer[0]) {
                firstNamedLayerOrUserLayer =
                    sldObject.value.namedLayerOrUserLayer[0];
                if (firstNamedLayerOrUserLayer.namedStyleOrUserStyle &amp;&amp;
                  firstNamedLayerOrUserLayer.namedStyleOrUserStyle[0] &amp;&amp;
                  firstNamedLayerOrUserLayer.namedStyleOrUserStyle[0]
                      .featureTypeStyle &amp;&amp;
                  firstNamedLayerOrUserLayer.namedStyleOrUserStyle[0]
                      .featureTypeStyle[0] &amp;&amp;
                  firstNamedLayerOrUserLayer.namedStyleOrUserStyle[0]
                      .featureTypeStyle[0].rule) {
                    return firstNamedLayerOrUserLayer.namedStyleOrUserStyle[0]
                        .featureTypeStyle[0].rule;
                }
            }

            return {};
        },

<span id='BasiGX-util-SldOpenlayersConverter-static-method-setRulesOfSldObject'>        /**
</span>         * @param {Object} sldObject The SLD object.
         * @param {Array} rules The rules orray.
         * @return {Object} The SLD Object.
         */
        setRulesOfSldObject: function(sldObject, rules) {
            sldObject.value.
                namedLayerOrUserLayer[0].
                namedStyleOrUserStyle[0].
                featureTypeStyle[0].
                rule = rules;
            return sldObject;
        },

<span id='BasiGX-util-SldOpenlayersConverter-static-method-isLogicalFilter'>        /**
</span>         * @param {Object} filter The filter object.
         * @return {boolean} True if filter is logical.
         */
        isLogicalFilter: function(filter) {
            return &#39;logicOps&#39; in filter;
        },

<span id='BasiGX-util-SldOpenlayersConverter-static-method-isSpatialFilter'>        /**
</span>         * @param {Object} filter The filter object.
         * @return {boolean} True if filter is spatial.
         */
        isSpatialFilter: function(filter) {
            return &#39;spatialOps&#39; in filter;
        },

<span id='BasiGX-util-SldOpenlayersConverter-static-method-isComparisonFilter'>        /**
</span>         * @param {Object} filter The filter object.
         * @return {boolean} True if filter is comparable.
         */
        isComparisonFilter: function(filter) {
            return &#39;comparisonOps&#39; in filter;
        },

<span id='BasiGX-util-SldOpenlayersConverter-static-method-getPropertyNameFromFilter'>        /**
</span>         * @param {Object} filter The filter object.
         * @return {String} The property name.
         */
        getPropertyNameFromFilter: function(filter) {
            var operator = filter.comparisonOps.name.localPart;
            var propertyName;
            switch (operator) {
                case &#39;PropertyIsNull&#39;:
                    propertyName = filter.comparisonOps.value.propertyName
                        .content[0];
                    break;
                case &#39;PropertyIsLike&#39;:
                    propertyName = filter.comparisonOps.value.propertyName
                        .content[0];
                    break;
                case &#39;PropertyIsBetween&#39;:
                    propertyName = filter.comparisonOps.value.expression.value
                        .content[0];
                    break;
                default:
                    propertyName = filter.comparisonOps.value.expression[0]
                        .value.content[0];
                    break;
            }
            return propertyName;
        },

<span id='BasiGX-util-SldOpenlayersConverter-static-method-getLiteralValuesFromFilter'>        /**
</span>         * @param {Object} filter The filter object.
         * @return {Array} The lieteral values array.
         */
        getLiteralValuesFromFilter: function(filter) {
            var operator = filter.comparisonOps.name.localPart;
            var literalValues = [];
            switch (operator) {
                case &#39;PropertyIsNull&#39;:
                    literalValues = null;
                    break;
                case &#39;PropertyIsLike&#39;:
                    literalValues.push(
                        filter.comparisonOps.value.literal.content[0]);
                    break;
                case &#39;PropertyIsBetween&#39;:
                    literalValues.push(filter.comparisonOps.value.lowerBoundary
                        .expression.value.content[0]);
                    literalValues.push(filter.comparisonOps.value.upperBoundary
                        .expression.value.content[0]);
                    break;
                default:
                    literalValues.push(filter.comparisonOps.value
                        .expression[1].value.content[0]);
                    break;
            }
            return literalValues;
        },

<span id='BasiGX-util-SldOpenlayersConverter-static-method-styleFromSymbolizers'>        /**
</span>         * @param {Array} symbolizers The symbolizers array.
         * @return {Array} The style array.
         */
        styleFromSymbolizers: function(symbolizers) {
            var sldUtil = BasiGX.util.SldOpenlayersConverter;
            if (!Ext.isArray(symbolizers)) {
                symbolizers = [symbolizers];
            }

            var styleArr = [];

            Ext.each(symbolizers, function(symbolizer) {
                styleArr.push(sldUtil.styleFromSymbolizer(symbolizer));
            });

            return styleArr;
        },

<span id='BasiGX-util-SldOpenlayersConverter-static-method-styleFromSymbolizer'>        /**
</span>         * @param {Object} symbolizer The symbolizer object.
         * @return {Object} The style object.
         */
        styleFromSymbolizer: function(symbolizer) {
            var sldUtil = BasiGX.util.SldOpenlayersConverter;
            var symbolType = sldUtil.symbolTypeFromSymbolizer(symbolizer);

            var style;
            switch (symbolType) {
                case &#39;Point&#39;:
                    style = sldUtil.pointStyleFromSymbolizer(symbolizer);
                    break;
                case &#39;Line&#39;:
                    style = sldUtil.lineStyleFromSymbolizer(symbolizer);
                    break;
                case &#39;Polygon&#39;:
                    style = sldUtil.polygonStyleFromSymbolizer(symbolizer);
                    break;
                case &#39;Text&#39;:
                    style = sldUtil.textStyleFromSymbolizer(symbolizer);
                    break;
                case &#39;Raster&#39;:
                    // IDK…
                    Ext.log.warn(&#39;Unimplemented symbolType \&#39;Raster\&#39;&#39;);
                    break;
                default:
                    Ext.log.warn(
                        &#39;Unexpected symbolType \&#39;&#39; + symbolType + &#39;\&#39;&#39;
                    );
            }
            return style;
        },

<span id='BasiGX-util-SldOpenlayersConverter-static-method-getFirstCssParameterContentByName'>        /**
</span>         * @param {Array} cssParameters The cssParameters array.
         * @param {String} name The name.
         * @return {String} The content.
         */
        getFirstCssParameterContentByName: function(cssParameters, name) {
            var content;
            Ext.each(cssParameters, function(cssParameter) {
                if (cssParameter.name === name) {
                    content = cssParameter.content[0];
                    return false; // … and stop iteration
                }
            });
            return content;
        },

<span id='BasiGX-util-SldOpenlayersConverter-static-method-fillFromObj'>        /**
</span>         * @param {Object} mark The mark object.
         * @return {Object} The fill object.
         */
        fillFromObj: function(mark) {
            var sldUtil = BasiGX.util.SldOpenlayersConverter;
            var fill;
            if (&#39;fill&#39; in mark) {
                // find the correct cssParameter
                var fillColor = sldUtil.getFirstCssParameterContentByName(
                    mark.fill.cssParameter, &#39;fill&#39;
                );
                var fillOpacity = sldUtil.getFirstCssParameterContentByName(
                    mark.fill.cssParameter, &#39;fill-opacity&#39;
                ) || sldUtil.DEFAULT_FILL_OPACITY;

                fillColor = BasiGX.util.Color.hexToRgba(fillColor, fillOpacity);
                fill = new ol.style.Fill({
                    color: fillColor
                });
            }
            return fill;
        },

<span id='BasiGX-util-SldOpenlayersConverter-static-method-strokeFromObj'>        /**
</span>         * @param {Object} mark The mark Object.
         * @return {Object} The stroke object.
         */
        strokeFromObj: function(mark) {
            var sldUtil = BasiGX.util.SldOpenlayersConverter;
            var stroke;
            if (&#39;stroke&#39; in mark) {
                var strokeColor = sldUtil.getFirstCssParameterContentByName(
                    mark.stroke.cssParameter, &#39;stroke&#39;
                ) || sldUtil.DEFAULT_STROKE_COLOR;
                var strokeWidth = sldUtil.getFirstCssParameterContentByName(
                    mark.stroke.cssParameter, &#39;stroke-width&#39;
                ) || sldUtil.DEFAULT_STROKE_WIDTH;
                var strokeOpacity = sldUtil.getFirstCssParameterContentByName(
                    mark.stroke.cssParameter, &#39;stroke-opacity&#39;
                ) || sldUtil.DEFAULT_STROKE_OPACITY;

                strokeColor = BasiGX.util.Color.hexToRgba(strokeColor,
                    strokeOpacity);
                stroke = new ol.style.Stroke({
                    color: strokeColor,
                    width: strokeWidth
                    // TODO there are more… lineCap, lineJoin, lineDash,
                    //      miterLimit, they&#39;ll all have an SLD equivalent
                });
            }
            return stroke;
        },

<span id='BasiGX-util-SldOpenlayersConverter-static-method-pointStyleFromSymbolizer'>        /**
</span>         * @param {Object} symbolizer The symbolizer Object.
         * @return {Object} The style object.
         */
        pointStyleFromSymbolizer: function(symbolizer) {
            // ol.style.Style with image either ol.style.Circle or
            // ol.style.Icon, or basically also ol.style.RegularShape,
            // for wkts
            var sldUtil = BasiGX.util.SldOpenlayersConverter;
            var graphic = symbolizer.value.graphic;
            var size = parseFloat(graphic.size.content, 10);
            var firstGraphicOrMark = graphic.externalGraphicOrMark[0];
            var firstTypeName = firstGraphicOrMark.TYPE_NAME;
            var style;
            var wellKnownName;
            if ((/Mark/).test(firstTypeName)) {
                // … ol.style.Circle or ol.style.RegularShape
                if (firstGraphicOrMark.wellKnownName) {
                    wellKnownName = firstGraphicOrMark.wellKnownName.content[0];
                }
                var fill = sldUtil.fillFromObj(firstGraphicOrMark);
                var stroke = sldUtil.strokeFromObj(firstGraphicOrMark);

                switch (wellKnownName) {
                    case &#39;circle&#39;:
                        style = new ol.style.Style({
                            image: new ol.style.Circle({
                                radius: size,
                                fill: fill,
                                stroke: stroke
                            })
                        });
                        break;
                    case &#39;square&#39;:
                        style = new ol.style.Style({
                            image: new ol.style.RegularShape({
                                fill: fill,
                                stroke: stroke,
                                points: 4,
                                radius: size,
                                angle: Math.PI / 4
                            })
                        });
                        break;
                    case &#39;triangle&#39;:
                        style = new ol.style.Style({
                            image: new ol.style.RegularShape({
                                fill: fill,
                                stroke: stroke,
                                points: 3,
                                radius: size,
                                rotation: Math.PI / 4,
                                angle: 0
                            })
                        });
                        break;
                    case &#39;star&#39;:
                        style = new ol.style.Style({
                            image: new ol.style.RegularShape({
                                fill: fill,
                                stroke: stroke,
                                points: 5,
                                radius: size,
                                radius2: size / 2,
                                angle: 0
                            })
                        });
                        break;
                    case &#39;cross&#39;:
                        style = new ol.style.Style({
                            image: new ol.style.RegularShape({
                                fill: fill,
                                stroke: stroke,
                                points: 4,
                                radius: size,
                                radius2: size / 2,
                                angle: 0
                            })
                        });
                        break;
                    case &#39;x&#39;:
                        style = new ol.style.Style({
                            image: new ol.style.RegularShape({
                                fill: fill,
                                stroke: stroke,
                                points: 4,
                                radius: size,
                                radius2: size / 2,
                                angle: Math.PI / 4
                            })
                        });
                        break;
                    default:
                        style = new ol.style.Style({
                            image: new ol.style.Circle({
                                radius: 10,
                                fill: new ol.style.Fill({
                                    color: &#39;#3399CC&#39;
                                }),
                                stroke: new ol.style.Stroke({
                                    color: &#39;#FFFFFF&#39;,
                                    width: 1.25
                                })
                            })
                        });
                        break;
                }
            } else if ((/Graphic/).test(firstTypeName)) {
                // … ol.style.Icon
                var imageSrc = sldUtil.onlineResourceFromGraphic(
                    firstGraphicOrMark
                );
                style = new ol.style.Style({
                    image: new ol.style.Icon({
                        src: imageSrc,
                        // SLD size applies to height only if the image is
                        // rectangular, we&#39;ll fix this at the call site with
                        // a listener.
                        size: [size, size]
                    })
                });
            }

            return style;
        },

<span id='BasiGX-util-SldOpenlayersConverter-static-method-onlineResourceFromGraphic'>        /**
</span>         * @param {Object} graphic The graphic Object.
         * @return {String} The URL string.
         */
        onlineResourceFromGraphic: function(graphic) {
            var url;
            if ((/ExternalGraphic$/).test(graphic.TYPE_NAME)) {
                url = graphic.onlineResource.href;
            }
            return url;
        },

<span id='BasiGX-util-SldOpenlayersConverter-static-method-lineStyleFromSymbolizer'>        /**
</span>         * @param {Object} symbolizer The symbolizer Object.
         * @return {Object} The style object.
         */
        lineStyleFromSymbolizer: function(symbolizer) {
            var sldUtil = BasiGX.util.SldOpenlayersConverter;
            var symbValue = symbolizer.value;
            var stroke = sldUtil.strokeFromObj(symbValue);
            return new ol.style.Style({
                stroke: stroke
            });
        },

<span id='BasiGX-util-SldOpenlayersConverter-static-method-polygonStyleFromSymbolizer'>        /**
</span>         * @param {Object} symbolizer The symbolizer Object.
         * @return {Object} The style object.
         */
        polygonStyleFromSymbolizer: function(symbolizer) {
            var sldUtil = BasiGX.util.SldOpenlayersConverter;
            var symbValue = symbolizer.value;
            var fill = sldUtil.fillFromObj(symbValue);
            var stroke = sldUtil.strokeFromObj(symbValue);
            return new ol.style.Style({
                stroke: stroke,
                fill: fill
            });
        },

<span id='BasiGX-util-SldOpenlayersConverter-static-method-textStyleFromSymbolizer'>        /**
</span>         *
         */
        textStyleFromSymbolizer: function() {
            Ext.log.warn(&#39;#textStyleFromSymbolizer: Not implemented yet&#39;);
        },

<span id='BasiGX-util-SldOpenlayersConverter-static-method-symbolTypeFromSymbolizer'>        /**
</span>         * returns &#39;Point&#39;, &#39;Line&#39;, &#39;Polygon&#39;, &#39;Text&#39; or &#39;Raster&#39;
         * @param {Array} symbolizers The symbolizers Array.
         * @return {String} The geometry type.
         */
        symbolTypeFromSymbolizer: function(symbolizers) {
            var symbolType;
            if (!Ext.isArray(symbolizers)) {
                symbolizers = [symbolizers];
            }
            // the first symbolizer shall determine the type of symbol:
            if (symbolizers.length &gt;= 1) {
                var first = symbolizers[0];
                var localPart = Ext.String.trim(first.name.localPart);
                // These are the possibilities:
                // * PointSymbolizer
                // * LineSymbolizer
                // * PolygonSymbolizer
                // * TextSymbolizer
                // * RasterSymbolizer
                symbolType = localPart.replace(/Symbolizer$/, &#39;&#39;);
            }
            return symbolType;
        },

<span id='BasiGX-util-SldOpenlayersConverter-static-method-olSymbolizerToSldSymbolizer'>        /**
</span>         * @param {Object} olSymbolizer The olSymbolizer Object.
         * @return {Object} The SLD object.
         */
        olSymbolizerToSldSymbolizer: function(olSymbolizer) {
            // has an image so it is a point style
            if (olSymbolizer.getImage()) {
                return this.pointSymbolizerToSld(olSymbolizer);
            }
            // has no image but a fill so it is a polygon style
            if (olSymbolizer.getFill()) {
                return this.polygonSymbolizerToSld(olSymbolizer);

            }
            // has no image but a fill so it is a polygon style
            if (olSymbolizer.getStroke()) {
                return this.lineSymbolizerToSld(olSymbolizer);
            }
        },

<span id='BasiGX-util-SldOpenlayersConverter-static-method-pointSymbolizerToSld'>        /**
</span>         * @param {Object} olSymbolizer The olSymbolizer Object.
         * @return {Object} The SLD object.
         */
        pointSymbolizerToSld: function(olSymbolizer) {
            var sldSymbolizer = {
                name: {
                    namespaceURI: &#39;http://www.opengis.net/sld&#39;,
                    localPart: &#39;PointSymbolizer&#39;,
                    prefix: &#39;sld&#39;,
                    key: &#39;{http://www.opengis.net/sld}PointSymbolizer&#39;,
                    string: &#39;{http://www.opengis.net/sld}sld:PointSymbolizer&#39;,
                    CLASS_NAME: &#39;Jsonix.XML.QName&#39;
                },
                value: {
                    TYPE_NAME: &#39;SLD_1_0_0.PointSymbolizer&#39;,
                    graphic: {
                        TYPE_NAME: &#39;SLD_1_0_0.Graphic&#39;
                    }
                }
            };
            if (olSymbolizer.getImage() instanceof ol.style.Circle) {
                var fillColor = BasiGX.util.Color.rgbaToHex(
                    olSymbolizer.getImage().getFill().getColor());
                var fillOpacity = BasiGX.util.Color.rgbaAsArray(
                    olSymbolizer.getImage().getFill().getColor())[4];
                var radius = olSymbolizer.getImage().getRadius().toString();
                var strokeColor = BasiGX.util.Color.rgbaToHex(
                    olSymbolizer.getImage().getStroke().getColor());
                var strokeWidth = olSymbolizer.getImage().getStroke()
                    .getWidth().toString();
                var strokeOpacity = BasiGX.util.Color.rgbaAsArray(
                    olSymbolizer.getImage().getStroke().getColor())[4];

                sldSymbolizer.value.graphic.externalGraphicOrMark = [{
                    TYPE_NAME: &#39;SLD_1_0_0.Mark&#39;,
                    wellKnownName: {
                        TYPE_NAME: &#39;SLD_1_0_0.WellKnownName&#39;,
                        content: [&#39;circle&#39;]
                    },
                    fill: {
                        TYPE_NAME: &#39;SLD_1_0_0.Fill&#39;,
                        cssParameter: [{
                            TYPE_NAME: &#39;SLD_1_0_0.CssParameter&#39;,
                            name: &#39;fill&#39;,
                            content: [fillColor]
                        }, {
                            TYPE_NAME: &#39;SLD_1_0_0.CssParameter&#39;,
                            name: &#39;fill-opacity&#39;,
                            content: [fillOpacity]
                        }]
                    },
                    stroke: {
                        TYPE_NAME: &#39;SLD_1_0_0.Stroke&#39;,
                        cssParameter: [{
                            TYPE_NAME: &#39;SLD_1_0_0.CssParameter&#39;,
                            name: &#39;stroke&#39;,
                            content: [strokeColor]
                        }, {
                            TYPE_NAME: &#39;SLD_1_0_0.CssParameter&#39;,
                            name: &#39;stroke-width&#39;,
                            content: [strokeWidth]
                        }, {
                            TYPE_NAME: &#39;SLD_1_0_0.CssParameter&#39;,
                            name: &#39;stroke-opacity&#39;,
                            content: [strokeOpacity]
                        }]
                    }
                }];
                sldSymbolizer.value.graphic.size = {
                    TYPE_NAME: &#39;SLD_1_0_0.ParameterValueType&#39;,
                    content: [radius]
                };
            }
            if (olSymbolizer.getImage() instanceof ol.style.Icon) {
                var size = olSymbolizer.getImage().getSize()[1].toString();
                var src = olSymbolizer.getImage().getSrc();
                sldSymbolizer.value.graphic.externalGraphicOrMark = [{
                    TYPE_NAME: &#39;SLD_1_0_0.ExternalGraphic&#39;,
                    onlineResource: {
                        TYPE_NAME: &#39;SLD_1_0_0.OnlineResource&#39;,
                        type: &#39;simple&#39;,
                        href: src
                    },
                    format: &#39;image/png&#39;
                }];
                sldSymbolizer.value.graphic.size = {
                    TYPE_NAME: &#39;SLD_1_0_0.ParameterValueType&#39;,
                    content: [size]
                };
            }
            return sldSymbolizer;
        },

<span id='BasiGX-util-SldOpenlayersConverter-static-method-polygonSymbolizerToSld'>        /**
</span>         * @param {Object} olSymbolizer The olSymbolizer Object.
         * @return {Object} The SLD object.
         */
        polygonSymbolizerToSld: function(olSymbolizer) {
            var fillColor = BasiGX.util.Color.rgbaToHex(
                olSymbolizer.getFill().getColor());
            var fillOpacity = BasiGX.util.Color.rgbaAsArray(
                olSymbolizer.getFill().getColor())[4];
            var strokeColor = BasiGX.util.Color.rgbaToHex(
                olSymbolizer.getStroke().getColor());
            var strokeWidth = olSymbolizer.getStroke()
                .getWidth().toString();
            var strokeOpacity = BasiGX.util.Color.rgbaAsArray(
                olSymbolizer.getStroke().getColor())[4];

            var sldSymbolizer = {
                name: {
                    namespaceURI: &#39;http://www.opengis.net/sld&#39;,
                    localPart: &#39;PolygonSymbolizer&#39;,
                    prefix: &#39;sld&#39;,
                    key: &#39;{http://www.opengis.net/sld}PolygonSymbolizer&#39;,
                    string: &#39;{http://www.opengis.net/sld}sld:PolygonSymbolizer&#39;,
                    CLASS_NAME: &#39;Jsonix.XML.QName&#39;
                },
                value: {
                    TYPE_NAME: &#39;SLD_1_0_0.PolygonSymbolizer&#39;,
                    fill: {
                        TYPE_NAME: &#39;SLD_1_0_0.Fill&#39;,
                        cssParameter: [{
                            TYPE_NAME: &#39;SLD_1_0_0.CssParameter&#39;,
                            name: &#39;fill&#39;,
                            content: [fillColor]
                        }, {
                            TYPE_NAME: &#39;SLD_1_0_0.CssParameter&#39;,
                            name: &#39;fill-opacity&#39;,
                            content: [fillOpacity]
                        }]
                    },
                    stroke: {
                        TYPE_NAME: &#39;SLD_1_0_0.Stroke&#39;,
                        cssParameter: [{
                            TYPE_NAME: &#39;SLD_1_0_0.CssParameter&#39;,
                            name: &#39;stroke&#39;,
                            content: [strokeColor]
                        }, {
                            TYPE_NAME: &#39;SLD_1_0_0.CssParameter&#39;,
                            name: &#39;stroke-width&#39;,
                            content: [strokeWidth]
                        }, {
                            TYPE_NAME: &#39;SLD_1_0_0.CssParameter&#39;,
                            name: &#39;stroke-opacity&#39;,
                            content: [strokeOpacity]
                        }]
                    }
                }
            };
            return sldSymbolizer;
        },

<span id='BasiGX-util-SldOpenlayersConverter-static-method-lineSymbolizerToSld'>        /**
</span>         * @param {Object} olSymbolizer The olSymbolizer Object.
         * @return {Object} The SLD object.
         */
        lineSymbolizerToSld: function(olSymbolizer) {
            var strokeColor = BasiGX.util.Color.rgbaToHex(
                olSymbolizer.getStroke().getColor());
            var strokeWidth = olSymbolizer.getStroke()
                .getWidth().toString();
            var strokeOpacity = BasiGX.util.Color.rgbaAsArray(
                olSymbolizer.getStroke().getColor())[4];

            var sldSymbolizer = {
                name: {
                    namespaceURI: &#39;http://www.opengis.net/sld&#39;,
                    localPart: &#39;LineSymbolizer&#39;,
                    prefix: &#39;sld&#39;,
                    key: &#39;{http://www.opengis.net/sld}LineSymbolizer&#39;,
                    string: &#39;{http://www.opengis.net/sld}sld:LineSymbolizer&#39;,
                    CLASS_NAME: &#39;Jsonix.XML.QName&#39;
                },
                value: {
                    TYPE_NAME: &#39;SLD_1_0_0.LineSymbolizer&#39;,
                    stroke: {
                        TYPE_NAME: &#39;SLD_1_0_0.Stroke&#39;,
                        cssParameter: [{
                            TYPE_NAME: &#39;SLD_1_0_0.CssParameter&#39;,
                            name: &#39;stroke&#39;,
                            content: [strokeColor]
                        }, {
                            TYPE_NAME: &#39;SLD_1_0_0.CssParameter&#39;,
                            name: &#39;stroke-width&#39;,
                            content: [strokeWidth]
                        }, {
                            TYPE_NAME: &#39;SLD_1_0_0.CssParameter&#39;,
                            name: &#39;stroke-opacity&#39;,
                            content: [strokeOpacity]
                        }]
                    }
                }
            };
            return sldSymbolizer;
        },

<span id='BasiGX-util-SldOpenlayersConverter-static-method-filterValuesToSldFilter'>        /**
</span>         * @param {Object} filterValues The filterValues Object.
         * @return {Object} The SLD filter.
         */
        filterValuesToSldFilter: function(filterValues) {
            var sldFilter = {
                TYPE_NAME: &#39;Filter_1_0_0.FilterType&#39;,
                comparisonOps: {
                    name: {
                        namespaceURI: &#39;http://www.opengis.net/ogc&#39;,
                        localPart: filterValues.operatorCombo,
                        prefix: &#39;ogc&#39;,
                        key: &#39;{http://www.opengis.net/ogc}&#39; +
                                filterValues.operatorCombo,
                        string: &#39;{http://www.opengis.net/ogc}ogc:&#39; +
                                filterValues.operatorCombo,
                        CLASS_NAME: &#39;Jsonix.XML.QName&#39;
                    },
                    value: {
                        TYPE_NAME: &#39;Filter_1_0_0.BinaryComparisonOpType&#39;,
                        expression: [{
                            name: {
                                namespaceURI: &#39;http://www.opengis.net/ogc&#39;,
                                localPart: &#39;PropertyName&#39;,
                                prefix: &#39;ogc&#39;,
                                key: &#39;{http://www.opengis.net/ogc}PropertyName&#39;,
                                string: &#39;{http://www.opengis.net/ogc}&#39; +
                                        &#39;ogc:PropertyName&#39;,
                                CLASS_NAME: &#39;Jsonix.XML.QName&#39;
                            },
                            value: {
                                TYPE_NAME: &#39;Filter_1_0_0.PropertyNameType&#39;,
                                content: [filterValues.attributeCombo]
                            }
                        }, {
                            name: {
                                namespaceURI: &#39;http://www.opengis.net/ogc&#39;,
                                localPart: &#39;Literal&#39;,
                                prefix: &#39;ogc&#39;,
                                key: &#39;{http://www.opengis.net/ogc}Literal&#39;,
                                string: &#39;{http://www.opengis.net/ogc}&#39; +
                                        &#39;ogc:Literal&#39;,
                                CLASS_NAME: &#39;Jsonix.XML.QName&#39;
                            },
                            value: {
                                TYPE_NAME: &#39;Filter_1_0_0.LiteralType&#39;,
                                content: [filterValues.literalTextField]
                            }
                        }]
                    }
                }
            };

            switch (filterValues.operatorCombo) {
                case &#39;PropertyIsEqualTo&#39;:
                    break;
                case &#39;PropertyIsNotEqualTo&#39;:
                    break;
                case &#39;PropertyIsBetween&#39;:
                    sldFilter.comparisonOps.value = {
                        TYPE_NAME: &#39;Filter_1_0_0.PropertyIsBetweenType&#39;,
                        expression: {
                            name: {
                                namespaceURI: &#39;http://www.opengis.net/ogc&#39;,
                                localPart: &#39;PropertyName&#39;,
                                prefix: &#39;ogc&#39;,
                                key: &#39;{http://www.opengis.net/ogc}PropertyName&#39;,
                                string: &#39;{http://www.opengis.net/ogc}&#39; +
                                        &#39;ogc:PropertyName&#39;,
                                CLASS_NAME: &#39;Jsonix.XML.QName&#39;
                            },
                            value: {
                                TYPE_NAME: &#39;Filter_1_0_0.PropertyNameType&#39;,
                                content: [filterValues.attributeCombo]
                            }
                        },
                        lowerBoundary: {
                            TYPE_NAME: &#39;Filter_1_0_0.LowerBoundaryType&#39;,
                            expression: {
                                name: {
                                    namespaceURI: &#39;http://www.opengis.net/ogc&#39;,
                                    localPart: &#39;Literal&#39;,
                                    prefix: &#39;ogc&#39;,
                                    key: &#39;{http://www.opengis.net/ogc}Literal&#39;,
                                    string: &#39;{http://www.opengis.net/ogc}&#39; +
                                            &#39;ogc:Literal&#39;,
                                    CLASS_NAME: &#39;Jsonix.XML.QName&#39;
                                },
                                value: {
                                    TYPE_NAME: &#39;Filter_1_0_0.LiteralType&#39;,
                                    content: [filterValues.literalNumberField1
                                        .toString()]
                                }
                            }
                        },
                        upperBoundary: {
                            TYPE_NAME: &#39;Filter_1_0_0.UpperBoundaryType&#39;,
                            expression: {
                                name: {
                                    namespaceURI: &#39;http://www.opengis.net/ogc&#39;,
                                    localPart: &#39;Literal&#39;,
                                    prefix: &#39;ogc&#39;,
                                    key: &#39;{http://www.opengis.net/ogc}Literal&#39;,
                                    string: &#39;{http://www.opengis.net/ogc}&#39; +
                                            &#39;ogc:Literal&#39;,
                                    CLASS_NAME: &#39;Jsonix.XML.QName&#39;
                                },
                                value: {
                                    TYPE_NAME: &#39;Filter_1_0_0.LiteralType&#39;,
                                    content: [filterValues.literalNumberField2
                                        .toString()]
                                }
                            }
                        }
                    };
                    break;
                case &#39;PropertyIsLike&#39;:
                    sldFilter.comparisonOps.value = {
                        TYPE_NAME: &#39;Filter_1_0_0.PropertyIsLikeType&#39;,
                        wildCard: &#39;*&#39;,
                        singleChar: &#39;%&#39;,
                        escape: &#39;!&#39;,
                        propertyName: {
                            TYPE_NAME: &#39;Filter_1_0_0.PropertyNameType&#39;,
                            content: [filterValues.attributeCombo]
                        },
                        literal: {
                            TYPE_NAME: &#39;Filter_1_0_0.LiteralType&#39;,
                            content: [filterValues.literalTextField]
                        }
                    };
                    break;
                case &#39;PropertyIsNull&#39;:
                    sldFilter.comparisonOps.value = {
                        TYPE_NAME: &#39;Filter_1_0_0.PropertyIsNullType&#39;,
                        propertyName: {
                            TYPE_NAME: &#39;Filter_1_0_0.PropertyNameType&#39;,
                            content: [&#39;fid&#39;]
                        }
                    };
                    break;
                case &#39;PropertyIsLessThan&#39;:
                case &#39;PropertyIsLessThanOrEqualTo&#39;:
                case &#39;PropertyIsGreaterThan&#39;:
                case &#39;PropertyIsGreaterThanOrEqualTo&#39;:
                    sldFilter.comparisonOps.value.expression[1] = {
                        name: {
                            namespaceURI: &#39;http://www.opengis.net/ogc&#39;,
                            localPart: &#39;Literal&#39;,
                            prefix: &#39;ogc&#39;,
                            key: &#39;{http://www.opengis.net/ogc}Literal&#39;,
                            string: &#39;{http://www.opengis.net/ogc}ogc:Literal&#39;,
                            CLASS_NAME: &#39;Jsonix.XML.QName&#39;
                        },
                        value: {
                            TYPE_NAME: &#39;Filter_1_0_0.LiteralType&#39;,
                            content: [filterValues
                                .literalNumberField2.toString()]
                        }
                    };
                    break;
                default:
                    break;
            }
            return sldFilter;
        },

<span id='BasiGX-util-SldOpenlayersConverter-static-method-prettifySld'>        /**
</span>         * credits to
         * https://stackoverflow.com/questions/376373/pretty-printing-xml-with-
         * javascript
         *
         * @param {String} xml The xml String.
         * @return {String} The formatted SLD string.
         */
        prettifySld: function(xml) {
            var formatted = &#39;&#39;;
            var reg = /(&gt;)(&lt;)(\/*)/g;
            xml = xml.replace(reg, &#39;$1\r\n$2$3&#39;);
            var pad = 0;
            Ext.each(xml.split(&#39;\r\n&#39;), function(node) {
                var indent = 0;
                if (node.match(/.+&lt;\/\w[^&gt;]*&gt;$/)) {
                    indent = 0;
                } else if (node.match(/^&lt;\/\w/)) {
                    if (pad !== 0) {
                        pad -= 1;
                    }
                } else if (node.match(/^&lt;\w[^&gt;]*[^/]&gt;.*$/)) {
                    indent = 1;
                } else {
                    indent = 0;
                }

                var padding = &#39;&#39;;
                for (var i = 0; i &lt; pad; i++) {
                    padding += &#39;    &#39;;
                }

                formatted += padding + node + &#39;\r\n&#39;;
                pad += indent;
            });
            return formatted;
        },

<span id='BasiGX-util-SldOpenlayersConverter-static-method-validateSldString'>        /**
</span>         * @param {String} sld The sld String.
         * @return {boolean} True if the SLD is valid.
         */
        validateSldString: function(sld) {
            var valid = BasiGX.util.SldOpenlayersConverter.toSldObject(sld);
            if (valid !== null) {
                return true;
            } else {
                return false;
            }
        }

    }
});
</pre>
</body>
</html>
